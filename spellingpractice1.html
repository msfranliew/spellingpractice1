<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spelling Practice</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial, sans-serif; margin: 24px; max-width: 820px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin: 12px 0; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    button, input, textarea, select { font-size: 16px; padding: 10px 12px; border-radius: 10px; border: 1px solid #ccc; }
    button { cursor: pointer; }
    .big { font-size: 40px; font-weight: 800; letter-spacing: 0.5px; }
    .muted { color: #555; }
    .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; background: #f2f2f2; margin-right: 8px; }
    .ok { color: #0a7a2f; font-weight: 700; }
    .bad { color: #b00020; font-weight: 700; }
    .covered { filter: blur(10px); user-select: none; }
    textarea { width: 100%; height: 120px; }
  </style>
</head>
<body>
  <h1>Spelling Practice</h1>
  <p class="muted">Modes: Lookâ€“Coverâ€“Writeâ€“Check and Dictation (text-to-speech).</p>

  <div class="card">
    <h3>1) Word list (teacher can edit)</h3>
    <p class="muted">One word per line.</p>
    <textarea id="wordList">
friends
again
finally
receive
necessary
phenomenon
scrambled
miscalculation
companion
inspiration
    </textarea>
    <div class="row">
      <label>
        Mode
        <select id="mode">
          <option value="lcwc" selected>Lookâ€“Coverâ€“Writeâ€“Check</option>
          <option value="dictation">Dictation (speak the word)</option>
        </select>
      </label>
      <button id="startBtn">Start</button>
      <button id="resetBtn">Reset</button>
    </div>
  </div>

  <div class="card">
    <div class="row" style="justify-content: space-between;">
      <div>
        <span class="pill">Progress: <span id="prog">0/0</span></span>
        <span class="pill">Correct: <span id="correct">0</span></span>
        <span class="pill">Retry list: <span id="retryCount">0</span></span>
      </div>
      <div class="muted" id="status">Ready.</div>
    </div>

    <div style="margin-top: 14px;">
      <div class="muted">Target word:</div>
      <div id="target" class="big">â€”</div>
    </div>

    <div class="row" style="margin-top: 12px;">
      <button id="coverBtn" disabled>Cover</button>
      <button id="showBtn" disabled>Show</button>
      <button id="speakBtn" disabled>ðŸ”Š Speak</button>
    </div>

    <div class="row" style="margin-top: 12px;">
      <input id="answer" placeholder="Type the spellingâ€¦" disabled />
      <button id="checkBtn" disabled>Check</button>
      <button id="nextBtn" disabled>Next</button>
    </div>

    <div id="feedback" class="muted" style="margin-top: 10px;"></div>
  </div>

  <div class="card">
    <h3>Session Summary</h3>
    <div id="summary" class="muted">No session yet.</div>
    <div id="retryBox" class="muted" style="margin-top:10px;"></div>
  </div>

<script>
  const el = (id) => document.getElementById(id);

  let words = [];
  let idx = 0;
  let correct = 0;
  let retry = new Set();
  let covered = false;

  function cleanList(text) {
    return text
      .split("\n")
      .map(w => w.trim())
      .filter(w => w.length > 0);
  }

  function updateStats() {
    el("prog").textContent = `${Math.min(idx+1, words.length)}/${words.length}`;
    el("correct").textContent = String(correct);
    el("retryCount").textContent = String(retry.size);
  }

  function currentWord() {
    return words[idx] ?? "";
  }

  function showWord() {
    el("target").textContent = currentWord() || "â€”";
  }

  function setCovered(state) {
    covered = state;
    if (state) el("target").classList.add("covered");
    else el("target").classList.remove("covered");
  }

  function speak(text) {
    if (!("speechSynthesis" in window)) {
      el("feedback").innerHTML = `<span class="bad">Speech not supported</span> on this browser/device.`;
      return;
    }
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 0.9;
    u.pitch = 1.0;
    window.speechSynthesis.speak(u);
  }

  function start() {
    words = cleanList(el("wordList").value);
    if (words.length === 0) {
      el("status").textContent = "Please add at least 1 word.";
      return;
    }
    idx = 0;
    correct = 0;
    retry = new Set();

    el("status").textContent = "Go!";
    el("answer").disabled = false;
    el("checkBtn").disabled = false;
    el("nextBtn").disabled = false;
    el("coverBtn").disabled = false;
    el("showBtn").disabled = false;
    el("speakBtn").disabled = false;

    el("feedback").textContent = "";
    el("summary").textContent = "";
    el("retryBox").textContent = "";
    el("answer").value = "";

    showWord();
    setCovered(false);
    updateStats();

    // If dictation mode, auto-cover
    if (el("mode").value === "dictation") {
      setCovered(true);
      speak(currentWord());
    }
    el("answer").focus();
  }

  function resetAll() {
    words = [];
    idx = 0;
    correct = 0;
    retry = new Set();
    el("status").textContent = "Ready.";
    el("target").textContent = "â€”";
    el("answer").value = "";
    el("answer").disabled = true;
    el("checkBtn").disabled = true;
    el("nextBtn").disabled = true;
    el("coverBtn").disabled = true;
    el("showBtn").disabled = true;
    el("speakBtn").disabled = true;
    el("feedback").textContent = "";
    el("summary").textContent = "No session yet.";
    el("retryBox").textContent = "";
    updateStats();
  }

  function check() {
    const target = currentWord();
    const attempt = el("answer").value.trim();

    if (!target) return;

    if (attempt.length === 0) {
      el("feedback").innerHTML = `<span class="bad">Type your spelling first.</span>`;
      return;
    }

    if (attempt.toLowerCase() === target.toLowerCase()) {
      correct += 1;
      retry.delete(target);
      el("feedback").innerHTML = `<span class="ok">Correct!</span>`;
    } else {
      retry.add(target);
      el("feedback").innerHTML = `<span class="bad">Not quite.</span> Correct spelling: <b>${target}</b>`;
    }

    updateStats();
  }

  function next() {
    if (words.length === 0) return;

    idx += 1;
    if (idx >= words.length) {
      finish();
      return;
    }

    el("answer").value = "";
    el("feedback").textContent = "";
    showWord();
    setCovered(false);
    updateStats();

    if (el("mode").value === "dictation") {
      setCovered(true);
      speak(currentWord());
    }

    el("answer").focus();
  }

  function finish() {
    el("status").textContent = "Finished!";
    el("answer").disabled = true;
    el("checkBtn").disabled = true;
    el("nextBtn").disabled = true;
    el("coverBtn").disabled = true;
    el("showBtn").disabled = true;
    el("speakBtn").disabled = true;

    const total = words.length;
    const acc = total === 0 ? "â€”" : Math.round((correct / total) * 100) + "%";

    el("summary").innerText =
      `Words: ${total}\n` +
      `Correct: ${correct}\n` +
      `Accuracy: ${acc}\n` +
      `Mode: ${el("mode").selectedOptions[0].text}\n` +
      `Date: ${new Date().toLocaleString()}`;

    if (retry.size > 0) {
      el("retryBox").innerHTML =
        `<b>Retry these words:</b><br>` + Array.from(retry).join(", ");
    } else {
      el("retryBox").innerHTML = `<span class="ok">No retry words â€” well done!</span>`;
    }
  }

  el("startBtn").addEventListener("click", start);
  el("resetBtn").addEventListener("click", resetAll);
  el("checkBtn").addEventListener("click", check);
  el("nextBtn").addEventListener("click", next);
  el("coverBtn").addEventListener("click", () => setCovered(true));
  el("showBtn").addEventListener("click", () => setCovered(false));
  el("speakBtn").addEventListener("click", () => speak(currentWord()));
  el("answer").addEventListener("keydown", (e) => {
    if (e.key === "Enter") check();
  });

  // init
  resetAll();
</script>
</body>
</html>
